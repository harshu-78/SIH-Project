<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SIH ‚Äî SwasthyaSetu Kerala ‚Ä¢ Health Analytics Dashboard (Demo)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- jsPDF (for demo PDF export) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Font Awesome (for mic icon) -->
  <script src="https://kit.fontawesome.com/a81368914c.js" crossorigin="anonymous"></script>

  <style>
    /* header glass style example */
    .glass { background: rgba(255,255,255,0.6); backdrop-filter: blur(6px); }
    .heat-cell { height:48px; width:48px; border-radius:6px; }
    .tooltip { position: absolute; background: rgba(0,0,0,0.8); color: #fff; padding:6px 8px; border-radius:6px; font-size:13px; pointer-events:none; z-index:50; }
    /* make sure main content is not hidden under fixed header */
    main { padding-top: 5.5rem; } /* header is fixed ~56px (py-3), keep spacing */
  </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900">

 <!-- NAV -->
<header class="fixed w-full top-0 left-0 z-50 glass border-b">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <img src="assets/Kerala-Logo.png" alt="logo" class="h-10 w-10 rounded-md shadow-sm object-cover" onerror="this.style.display='none'"/>
      <div>
        <div data-translate="brand_name" class="font-bold text-lg text-sky-700">SwasthyaSetu</div>
        <div data-translate="brand_tag" class="text-xs text-slate-500 -mt-0.5">KERALA</div>
      </div>
    </div>

    <!-- large nav -->
    <nav class="hidden md:flex items-center gap-6 text-sm">
      <a data-translate="nav_home" href="index.html" class="nav-link hover:text-sky-600">Home</a>
      <a data-translate="nav_register" href="register.html" class="nav-link hover:text-sky-600">Register</a>
      <a data-translate="nav_dashboard" href="dashboard.html" class="nav-link hover:text-sky-600">Dashboard</a>
      <a data-translate="nav_analytics" href="analytics.html" class="nav-link hover:text-sky-600">Analytics</a>
      <a data-translate="nav_feedback" href="feedback.html" class="nav-link hover:text-sky-600">Feedback</a>
      <a data-translate="nav_contact" href="contact.html" class="nav-link hover:text-sky-600">Contact</a>
    </nav>

    <div class="flex items-center gap-3">
      <!-- language select -->
      <select id="languageSelect" class="border rounded-lg px-2 py-1 text-sm" aria-label="Language">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
        <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
      </select>

      <!-- voice + dark toggle -->
      <button id="voiceBtn" title="Voice assistant (speak / switch)" class="p-2 rounded-md hover:bg-slate-100">
        <i class="fa-solid fa-microphone text-sky-600"></i>
      </button>

      <button id="darkToggle" class="p-2 rounded-md hover:bg-slate-100" title="Toggle dark mode">
        <i id="darkIcon" class="fa-regular fa-moon text-slate-700"></i>
      </button>

      <!-- mobile menu -->
      <button id="menuBtn" class="md:hidden p-2 border rounded-md text-sky-700 border-sky-700">‚ò∞</button>
    </div>
  </div>

  <!-- mobile nav -->
  <div id="mobileNav" class="hidden md:hidden bg-white/95">
    <nav class="flex flex-col gap-2 px-4 py-3 text-sm">
      <a data-translate="nav_home" href="index.html" class="nav-link">Home</a>
      <a data-translate="nav_register" href="register.html" class="nav-link">Register</a>
      <a data-translate="nav_dashboard" href="dashboard.html" class="nav-link">Dashboard</a>
      <a data-translate="nav_analytics" href="analytics.html" class="nav-link">Analytics</a>
      <a data-translate="nav_feedback" href="feedback.html" class="nav-link">Feedback</a>
      <div class="pt-2">
        <select id="languageSelectMobile" class="w-full border rounded px-2 py-1 text-sm">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
          <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
          <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
          <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
          <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
        </select>
      </div>
    </nav>
  </div>
</header>

  <!-- MAIN CONTENT -->
  <main class="p-6 grid gap-6 max-w-7xl mx-auto">

    <!-- TOP METRICS -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="rounded-2xl p-5 shadow bg-white">
        <h3 class="text-sm text-slate-500">Active Cases</h3>
        <p id="activeCases" class="text-4xl font-bold text-red-600 mt-2">-</p>
        <p class="text-xs text-slate-400 mt-1">Updated live (simulated)</p>
      </div>

      <div class="rounded-2xl p-5 shadow bg-white">
        <h3 class="text-sm text-slate-500">High-Risk Districts</h3>
        <p id="highRiskCount" class="text-4xl font-bold text-orange-600 mt-2">-</p>
        <p class="text-xs text-slate-400 mt-1">Districts with High/Severe risk</p>
      </div>

      <div class="rounded-2xl p-5 shadow bg-white">
        <h3 class="text-sm text-slate-500">Avg. Response Time</h3>
        <p id="avgResp" class="text-4xl font-bold text-emerald-600 mt-2">-</p>
        <p class="text-xs text-slate-400 mt-1">Hours (simulated)</p>
      </div>
    </section>

    <!-- HEATMAP + CHARTS -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="col-span-1 lg:col-span-2 bg-white rounded-2xl p-4 shadow">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold">Outbreak Heatmap ‚Äî Kerala (Grid)</h2>
          <div class="flex items-center gap-2 text-sm text-slate-500">
            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-green-400"></span> Low</span>
            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-yellow-300"></span> Medium</span>
            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-orange-400"></span> High</span>
            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-red-600"></span> Severe</span>
          </div>
        </div>
        <div id="heatmap" class="grid grid-cols-6 gap-2"></div>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Disease Trend (Last 7 days)</h3>
        <select id="diseaseFilter" class="mb-3 p-2 rounded border text-sm w-full">
          <option value="All">All Diseases</option>
          <option value="Dengue">Dengue</option>
          <option value="Malaria">Malaria</option>
          <option value="Tuberculosis">Tuberculosis</option>
          <option value="Cholera">Cholera</option>
        </select>
        <canvas id="trendLine" class="w-full h-44"></canvas>
      </div>
    </section>

    <!-- Pie + AI Insights + Alerts -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Risk Distribution</h3>
        <canvas id="riskPie" class="h-44"></canvas>
        <div class="text-xs text-slate-500 mt-2">Breakdown by risk level</div>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-semibold">AI-Powered Insights</h3>
          <button id="exportBtn" class="text-sky-600 text-sm">Export Report</button>
        </div>
        <ul id="aiInsights" class="list-disc pl-5 text-sm text-slate-700"></ul>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Advisory & Alerts</h3>
        <div id="alerts" class="space-y-2 text-sm"></div>
      </div>
    </section>

    <!-- District Table + Prevention Tips -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="bg-white rounded-2xl p-4 shadow overflow-auto">
        <h3 class="font-semibold mb-3">District-wise Disease Data</h3>
        <table class="w-full text-sm">
          <thead class="text-left text-slate-500">
            <tr><th class="p-2">District</th><th>Disease</th><th>Active Cases</th><th>Risk Level</th></tr>
          </thead>
          <tbody id="districtTable"></tbody>
        </table>
        <p class="text-xs text-slate-400 mt-2">Hover rows to see prevention tips and click for advisory pop-up.</p>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-3">Prevention Tips & Disease Library</h3>
        <div id="diseaseLibrary" class="space-y-2 text-sm"></div>
      </div>
    </section>

    <!-- Map + Worker Tracker + Resource Allocation -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="col-span-2 bg-white rounded-2xl p-3 shadow">
        <h3 class="font-semibold mb-2">Interactive Kerala Map</h3>
        <div id="map" class="h-96 rounded"></div>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Worker Efficiency Tracker</h3>
        <div class="text-sm text-slate-600 mb-3">Health Workers active ‚Üí Patients checked ‚Üí Avg visits/day</div>
        <canvas id="workerChart" class="h-40 mb-3"></canvas>
        <div class="space-y-2 text-sm">
          <div>üë©‚Äç‚öï <span id="workersCount" class="font-semibold">-</span> Health Workers</div>
          <div>üßæ <span id="patientsCount" class="font-semibold">-</span> patients checked this week</div>
        </div>
      </div>
    </section>

    <!-- Correlation + Recommendations + Resources -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Disease Correlation Insights</h3>
        <ul id="correlationList" class="text-sm space-y-2 text-slate-700"></ul>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Smart Recommendation Engine</h3>
        <ul id="recommendations" class="text-sm space-y-2 text-slate-700"></ul>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h3 class="font-semibold mb-2">Resource Allocation</h3>
        <div id="resources" class="space-y-3 text-sm"></div>
      </div>
    </section>

  </main>

  <!-- SCRIPTS: data, charts, map, interactions -->
  <script>
    /* ---------------- Demo data ---------------- */
    const districts = [
      { district: 'Malappuram', disease: 'Dengue', cases: 240, risk: 'Severe', lat: 11.0738, lon: 76.0740 },
      { district: 'Ernakulam', disease: 'Malaria', cases: 120, risk: 'High', lat: 10.0306, lon: 76.3234 },
      { district: 'Thiruvananthapuram', disease: 'Tuberculosis', cases: 80, risk: 'Medium', lat: 8.5241, lon: 76.9366 },
      { district: 'Kozhikode', disease: 'Cholera', cases: 60, risk: 'Medium', lat: 11.2588, lon: 75.7804 },
      { district: 'Kollam', disease: 'Dengue', cases: 95, risk: 'High', lat: 8.8932, lon: 76.6141 },
      { district: 'Kottayam', disease: 'Malaria', cases: 40, risk: 'Low', lat: 9.5916, lon: 76.5228 }
    ];

    const diseaseTips = {
      'Dengue': 'Avoid stagnant water, use mosquito nets, wear full-sleeve clothes.',
      'Malaria': 'Use mosquito repellent, keep surroundings clean, sleep under nets.',
      'Tuberculosis': 'Maintain good ventilation, cover mouth while coughing, complete full course of medicines.',
      'Cholera': 'Drink boiled/treated water, maintain hygiene, seek immediate treatment.'
    };

    const labels = {
      en: { predicted: 'Potential outbreak predicted in', response: 'Response time improved by', alert: 'Alert' },
      hi: { predicted: '‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§™‡•ç‡§∞‡§ï‡•ã‡§™ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä', response: '‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞', alert: '‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä' },
      ml: { predicted: '‡¥Ö‡¥®‡µç‡¥µ‡µá‡¥∑‡¥£ ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§', response: '‡¥™‡µç‡¥∞‡¥§‡¥ø‡¥ï‡¥∞‡¥£ ‡¥∏‡¥Æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥Æ‡µÜ‡¥ö‡µç‡¥ö‡¥Ç', alert: '‡¥û‡µÜ‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡¥Ç' },
      bn: { predicted: '‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶æ‡¶¶‡ßÅ‡¶∞‡ßç‡¶≠‡¶æ‡¶¨ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶∏', response: '‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡¶§‡¶ø', alert: '‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ' }
    };

    /* ---------------- Top metrics ---------------- */
    function computeTopMetrics() {
      const totalCases = districts.reduce((s,d) => s + d.cases, 0);
      const highRiskCount = districts.filter(d => ['High','Severe'].includes(d.risk)).length;
      const avgResp = (1.5 + Math.random()*4).toFixed(1); // hours
      document.getElementById('activeCases').textContent = totalCases.toLocaleString();
      document.getElementById('highRiskCount').textContent = highRiskCount;
      document.getElementById('avgResp').textContent = `${avgResp} hrs`;
    }

    /* ---------------- Heatmap ---------------- */
    const heatmapEl = document.getElementById('heatmap');
    const heatLevels = ['bg-green-400','bg-yellow-300','bg-orange-400','bg-red-600'];
    function renderHeatmap() {
      heatmapEl.innerHTML = '';
      for (let i=0;i<36;i++){
        const idx = Math.floor(Math.random()*4);
        const cell = document.createElement('div');
        cell.className = `heat-cell ${heatLevels[idx]} shadow-sm`;
        cell.title = ['Low','Medium','High','Severe'][idx];
        heatmapEl.appendChild(cell);
      }
    }

    /* ---------------- Charts ---------------- */
    const trendCtx = document.getElementById('trendLine').getContext('2d');
    let trendChart = new Chart(trendCtx, {
      type: 'line',
      data: { labels: ['-6d','-5d','-4d','-3d','-2d','-1d','Today'], datasets: [{ label:'New cases', data: [], tension:0.3, borderWidth:2, pointRadius:2, borderColor:'#ef4444' }]},
      options: { responsive:true, plugins:{legend:{display:false}} }
    });

    const pieCtx = document.getElementById('riskPie').getContext('2d');
    let pieChart = new Chart(pieCtx, {
      type: 'doughnut',
      data: { labels: ['Low','Medium','High','Severe'], datasets:[{ data: [0,0,0,0], backgroundColor: ['#34d399','#facc15','#fb923c','#ef4444'] }]},
      options: { responsive:true, plugins:{legend:{position:'bottom'}} }
    });

    const workerCtx = document.getElementById('workerChart').getContext('2d');
    let workerChart = new Chart(workerCtx, {
      type: 'bar',
      data: { labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], datasets:[{ label:'Patients checked', data:[], borderRadius:6, backgroundColor:'#60a5fa' }] },
      options:{plugins:{legend:{display:false}}, responsive:true}
    });

    function randomTrendData(disease) {
      const base = { 'Dengue': 30, 'Malaria': 18, 'Tuberculosis': 8, 'Cholera': 5, 'All': 60 };
      const b = base[disease] || base['All'];
      return Array.from({length:7}).map(()=> Math.max(0, Math.round(b + (Math.random()-0.4)*b)));
    }

    function updateCharts(filter='All'){
      const data = randomTrendData(filter);
      trendChart.data.datasets[0].data = data;
      trendChart.update();

      const counts = [0,0,0,0];
      districts.forEach(d=>{
        const idx = { 'Low':0,'Medium':1,'High':2,'Severe':3 }[d.risk] || 0;
        counts[idx] += d.cases;
      });
      for(let i=0;i<4;i++) counts[i] = Math.round(counts[i] * (0.8 + Math.random()*0.6));
      pieChart.data.datasets[0].data = counts;
      pieChart.update();

      const workerData = Array.from({length:7}).map(()=> Math.round(200 + Math.random()*800));
      workerChart.data.datasets[0].data = workerData;
      workerChart.update();

      const totalCases = counts.reduce((s,n)=>s+n,0);
      document.getElementById('activeCases').textContent = totalCases.toLocaleString();
      const highRiskCount = districts.filter(d=>['High','Severe'].includes(d.risk)).length;
      document.getElementById('highRiskCount').textContent = highRiskCount;
      document.getElementById('avgResp').textContent = (1.2 + Math.random()*4).toFixed(1) + ' hrs';

      const patients = workerData.reduce((s,n)=>s+n,0);
      document.getElementById('workersCount').textContent = 245;
      document.getElementById('patientsCount').textContent = patients.toLocaleString();
    }

    /* ---------------- District Table ---------------- */
    const districtTable = document.getElementById('districtTable');
    function renderDistrictTable(){
      districtTable.innerHTML = '';
      districts.forEach(d=>{
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-slate-50 cursor-pointer';
        tr.innerHTML = `<td class="p-2">${d.district}</td><td>${d.disease}</td><td>${d.cases}</td><td class="font-semibold ${d.risk==='Severe'?'text-red-600':d.risk==='High'?'text-orange-600':'text-emerald-600'}">${d.risk}</td>`;
        tr.addEventListener('mouseenter', ()=> showTip(d, tr));
        tr.addEventListener('mouseleave', hideTip);
        tr.addEventListener('click', ()=> showAlertPopup(d));
        districtTable.appendChild(tr);
      });
    }

    let tipEl;
    function showTip(d, el){
      tipEl = document.createElement('div');
      tipEl.className = 'absolute z-40 p-3 bg-white rounded shadow text-sm border';
      const rect = el.getBoundingClientRect();
      tipEl.style.left = Math.min(window.innerWidth - 260, rect.right + 12) + 'px';
      tipEl.style.top = (window.scrollY + rect.top) + 'px';
      tipEl.innerHTML = `<b>${d.disease}</b><div class="mt-1 text-xs">${d.cases} active cases ‚Ä¢ ${d.risk} risk</div><div class="mt-2 text-xs text-slate-600"><b>Prevention:</b> ${diseaseTips[d.disease] || '‚Äî'}</div>`;
      document.body.appendChild(tipEl);
    }
    function hideTip(){ if(tipEl){ tipEl.remove(); tipEl=null; } }

    function showAlertPopup(d){
      alert(`Alert for ${d.district}\nDisease: ${d.disease}\nActive cases: ${d.cases}\nRisk: ${d.risk}\n\nPrevention: ${diseaseTips[d.disease] || ''}`);
    }

    /* ---------------- Disease Library ---------------- */
    const lib = document.getElementById('diseaseLibrary');
    function renderLibrary(){
      lib.innerHTML='';
      Object.keys(diseaseTips).forEach(k=>{
        const card = document.createElement('div');
        card.className = 'border rounded p-3';
        card.innerHTML = `<div class="flex justify-between items-center"><div><b>${k}</b><div class="text-xs text-slate-500">Symptoms: fever, body pain, etc.</div></div><button class="text-sm text-sky-600">Show</button></div>`;
        const btn = card.querySelector('button');
        btn.addEventListener('click', ()=> alert(`${k}\n\nPrevention:\n${diseaseTips[k]}\n\nEmergency Contact: 1075`));
        lib.appendChild(card);
      });
    }

    /* ---------------- AI Insights / Alerts / Recs / Corr ---------------- */
    const aiInsightsEl = document.getElementById('aiInsights');
    const alertsEl = document.getElementById('alerts');
    const recEl = document.getElementById('recommendations');
    const corrEl = document.getElementById('correlationList');
    const resourcesEl = document.getElementById('resources');

    function generateAIInsights(){
      aiInsightsEl.innerHTML = '';
      const insights = [
        `‚ö† Potential outbreak predicted in Malappuram within 5 days`,
        `‚úÖ Response time improved by 20% this week`,
        `üîé High vector density detected in coastal belt ‚Äî monitor closely`
      ];
      insights.forEach(i=>{ const li=document.createElement('li'); li.textContent=i; aiInsightsEl.appendChild(li); });

      alertsEl.innerHTML = '';
      const severe = districts.filter(d=>d.risk==='Severe');
      severe.forEach(s=>{
        const div = document.createElement('div');
        div.className = 'p-3 rounded border-l-4 border-red-600 bg-red-50 text-sm';
        div.innerHTML = `<b>‚ö† Alert:</b> ${s.disease} cases rising in ${s.district}. Take precautions!`;
        alertsEl.appendChild(div);
      });

      recEl.innerHTML = '';
      const recoms = [
        'Based on high dengue cases, distributing mosquito nets in 3 districts is recommended.',
        'Malaria awareness campaigns suggested in coastal districts.',
        'Increase bed capacity and mobile testing in Malappuram.'
      ];
      recoms.forEach(r=>{ const li=document.createElement('div'); li.className='text-sm'; li.textContent=r; recEl.appendChild(li); });

      corrEl.innerHTML = '';
      const corrs = [
        'üìä Areas with poor sanitation ‚Üí Higher Cholera cases.',
        'üåß Heavy rainfall districts ‚Üí Higher Dengue risk.',
        'üèò Dense settlements ‚Üí Faster TB transmission in some pockets.'
      ];
      corrs.forEach(c=>{ const li=document.createElement('li'); li.textContent=c; corrEl.appendChild(li); });

      resourcesEl.innerHTML = '';
      const resources = [
        {title:'Beds Available ‚Äî Malappuram', value:'120 beds'},
        {title:'Vaccines Stock ‚Äî Ernakulam', value:'4,000 doses'},
        {title:'Rapid Test Kits ‚Äî Kozhikode', value:'650 kits'}
      ];
      resources.forEach(r=>{
        const d = document.createElement('div'); d.className='p-2 border rounded'; d.innerHTML = `<div class="text-sm">${r.title}</div><div class="font-semibold">${r.value}</div>`; resourcesEl.appendChild(d);
      });
    }

    /* ---------------- Leaflet Map ---------------- */
    const map = L.map('map', { zoomControl:true }).setView([10.85,76.27],7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:''}).addTo(map);
    districts.forEach(d=>{
      const color = d.risk==='Severe' ? '#ef4444' : d.risk==='High' ? '#fb923c' : d.risk==='Medium' ? '#facc15' : '#34d399';
      const m = L.circleMarker([d.lat,d.lon], { radius:8, color, fillColor: color, fillOpacity:0.8 }).addTo(map);
      m.bindPopup(`<b>${d.district}</b><br/>${d.disease} ‚Äî ${d.cases} cases<br/><small>Risk: ${d.risk}</small>`);
      m.on('click', ()=> alert(`${d.district} ‚Äî ${d.disease}\nActive cases: ${d.cases}\nRisk: ${d.risk}\n\nPrevention:\n${diseaseTips[d.disease]}`));
    });

    /* ---------------- Export (CSV + PDF demo) ---------------- */
    document.getElementById('exportBtn').addEventListener('click', ()=> exportReport());
    function exportReport(){
      const header = ['District','Disease','ActiveCases','Risk'];
      const rows = districts.map(d=>[d.district,d.disease,d.cases,d.risk]);
      const csv = [header.join(','), ...rows.map(r=>r.join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'district_report.csv'; a.click(); URL.revokeObjectURL(url);

      // simple PDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(12); doc.text('Health Analytics Report (Demo)', 10, 10);
      doc.text(`Generated: ${new Date().toLocaleString()}`, 10, 18);
      doc.text('Districts:', 10, 28);
      districts.forEach((d,i)=> doc.text(`${i+1}. ${d.district} ‚Äî ${d.disease} ‚Äî ${d.cases} cases ‚Äî ${d.risk}`, 10, 36 + i*6));
      doc.save('health_report_demo.pdf');
    }

    /* ---------------- Language switching + mobile menu + voice placeholder ---------------- */
    const languageSelect = document.getElementById('languageSelect');
    const languageSelectMobile = document.getElementById('languageSelectMobile');
    const menuBtn = document.getElementById('menuBtn');
    const mobileNav = document.getElementById('mobileNav');
    const voiceBtn = document.getElementById('voiceBtn');

    // open/close mobile nav
    menuBtn.addEventListener('click', ()=> {
      mobileNav.classList.toggle('hidden');
    });

    // keep desktop and mobile language synchronized
    function setLanguage(lang) {
      // update UI small demo: update AI insights text
      const predicted = labels[lang]?.predicted || labels['en'].predicted;
      const response = labels[lang]?.response || labels['en'].response;
      const items = aiInsightsEl.querySelectorAll('li');
      if(items.length >= 2) {
        items[0].textContent = `‚ö† ${predicted} in Malappuram within 5 days`;
        items[1].textContent = `‚úÖ ${response} by 20% this week`;
      }
      languageSelect.value = lang;
      languageSelectMobile.value = lang;
    }

    languageSelect.addEventListener('change', (e)=> setLanguage(e.target.value));
    languageSelectMobile.addEventListener('change', (e)=> setLanguage(e.target.value));

    // voice button (placeholder)
    voiceBtn.addEventListener('click', ()=> {
      alert('Voice assistant demo ‚Äî integrate Web Speech API or other voice SDK here.');
    });

    /* ---------------- Init + periodic simulation ---------------- */
    function init(){
      renderHeatmap();
      renderDistrictTable();
      renderLibrary();
      generateAIInsights();
      updateCharts('All');
      computeTopMetrics();
    }
    init();

    // periodic simulated refresh for demo live feel
    setInterval(()=>{ renderHeatmap(); updateCharts(document.getElementById('diseaseFilter').value); generateAIInsights(); computeTopMetrics(); }, 2500);

    document.getElementById('diseaseFilter').addEventListener('change', (e)=> updateCharts(e.target.value));

    /* close mobile nav when clicking outside (small UX improvement) */
    document.addEventListener('click', (e) => {
      if (!menuBtn.contains(e.target) && !mobileNav.contains(e.target)) {
        if (!mobileNav.classList.contains('hidden')) mobileNav.classList.add('hidden');
      }
    });

  </script>
  <script src="js/translate.js"></script>
</body>
</html>
